<!DOCTYPE html>
<html>
<head>
    <title>New apartments interactive list with history</title>
    <link rel="stylesheet" type="text/css" href="css/generator.css">
</head>
<body><div id="wrapper" class="wrapper"></div></body>
<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="js/generator.js"></script>
<script>
"use strict";
console.time("default");
var n, snapObj, tableStr;
n = +window.location.search.slice(1,2);
if (n < 1 || n > 3) { n = 1; }
r9mk.init(n);
tableStr = r9mk.drawTable(n - 1);
document.getElementById('wrapper').innerHTML = tableStr;
//console.log(JSON.stringify(r9mk.buildings[n-1].flats4export));
$.ajax('http://nbs.loc/jsdb/bd' + n + '_price_stat.json', {
    complete: function(xhrObj) {
       var key, tmp, res = {}, res2 = [];
       console.log(xhrObj);
       xhrObj.responseJSON.forEach(function(val, key){
           if(!res[val.week]){
               res[val.week] = {};
           }
           res[val.week][val.rooms] = val.price4meter;
           res[val.week][val.rooms + "q"] = val.flatsQ;
       });
       for (key in res){
           tmp = res[key];
           tmp.week = key;
           res2.push(tmp);
       }

       console.log(JSON.stringify(res2)); }
});
//console.log(table);
console.timeEnd("default");
</script>
</html>